{% set element_id = formElement.vars.id %}
{% set element_name = formElement.vars.name %}
{% set is_required = formElement.vars.required %}
{% set has_errors = formElement.vars.errors|length > 0 %}

<div class="file-input-container {% if compact %}file-input-compact{% endif %} {% if has_errors %}has-errors{% endif %}"
     id="file-input-{{ element_id }}">

    {# Label #}
    {% if formElement.vars.label is defined and formElement.vars.label %}
        <label for="{{ element_id }}" class="block text-sm font-normal text-text-300 mb-2">
            {{ formElement.vars.label }}
            {% if is_required %}<span class="text-red-500">*</span>{% endif %}
        </label>
    {% endif %}

    {# Zone de drop personnalisée #}
    <label for="{{ element_id }}"
           class="file-input-label {% if has_errors %}has-error{% endif %}{% if existingImageUrl %}has-success{% endif %}"
           id="file-label-{{ element_id }}">
        <div class="file-input-content">
            <svg class="file-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>

            <div class="file-input-text">
                <strong>Cliquez pour uploader</strong> ou glissez-déposez
            </div>

            <div class="file-input-hint">
                {{ acceptedTypes }}
            </div>
        </div>
    </label>

    {# Input file caché #}
    {{ form_widget(formElement, {
        'attr': {
            'class': 'file-input',
            'data-file-input': element_id
        }
    }) }}

    {# Zone d'affichage du fichier sélectionné #}
    <div class="file-selected {% if not existingImageUrl %}hidden{% endif %}" id="file-selected-{{ element_id }}">
        <div class="file-selected-content">
            <div class="file-info">
                <svg class="file-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <span class="file-name" id="file-name-{{ element_id }}">
                        {% if existingImageUrl %}
                            Image déjà téléversée
                        {% endif %}
                    </span>
            </div>
            <div class="file-remove" data-file-remove="{{ element_id }}">
                <svg class="file-remove-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
        </div>

        {# Aperçu d'image #}
        {% if showPreview %}
            <div class="file-preview" id="file-preview-{{ element_id }}">
                {% if existingImageUrl %}
                    <img src="{{ existingImageUrl }}" class="file-preview-image" alt="Aperçu" id="preview-image-{{ element_id }}">
                {% else %}
                    <img src="" class="file-preview-image" alt="Aperçu" id="preview-image-{{ element_id }}">
                {% endif %}
            </div>
        {% endif %}
    </div>

    {# Messages d'erreur #}
    {% if has_errors %}
        <div class="text-red-500 text-xs mt-2">
            {{ form_errors(formElement) }}
        </div>
    {% endif %}
</div>
